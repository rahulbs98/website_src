<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Blog - Rahul Satish</title>
  <link rel="stylesheet" href="assets/css/style.css">
  <script src="assets/js/components.js" defer></script>
</head>
<body>
  <header>
    <nav>
      <a href="index.html" class="logo">Rahul Satish</a>
      <div class="nav-links">
        <a href="about.html">Bio</a>
        <a href="publications.html">Research</a>
        <a href="blog.html">Blog</a>
        <a href="links.html">Links</a>
        <a href="albums/" target="_blank">Albums</a>
        <a href="assets/data/cv.pdf" target="_blank">CV</a>
      </div>
      <button id="theme-toggle" aria-label="Toggle theme">ðŸŒ™</button>
      <button id="menu-toggle" class="menu-toggle" aria-label="Toggle menu">â˜°</button>
    </nav>
  </header>

  <main>
    <h1>Latest Articles</h1>
    <p style="font-size: 1.1rem; color: var(--color-text-secondary); margin-bottom: var(--spacing-xl);">
      Thoughts on cryptography, privacy, security, and technology via Substack.
    </p>

    <div id="blog-container" class="blog-grid">
      <!-- Blog posts will be loaded here -->
    </div>
    
    <div id="loading" class="empty-state" style="display: none;">
      <p>Loading articles...</p>
    </div>

    <div id="error" class="empty-state" style="display: none;">
      <p>Unable to load articles. Please try again later.</p>
    </div>
  </main>

  <script>
    /**
     * Substack Blog Manager - Fetches RSS feed and displays posts
     */
    class SubstackBlogManager {
      constructor(substackUsername) {
        this.substackUsername = substackUsername;
        this.feedUrl = `https://${substackUsername}.substack.com/api/v1/posts?limit=50&sort=new`;
        this.blogPosts = [];
      }

      async loadBlogPosts() {
        const loadingDiv = document.getElementById('loading');
        const errorDiv = document.getElementById('error');
        const container = document.getElementById('blog-container');

        try {
          loadingDiv.style.display = 'block';

          // Try to fetch from Substack API
          const response = await fetch(this.feedUrl);
          
          if (!response.ok) {
            throw new Error('Failed to fetch from Substack');
          }

          const data = await response.json();
          this.blogPosts = this.processSubstackPosts(data.posts || []);
          
          loadingDiv.style.display = 'none';
          this.render();
        } catch (error) {
          console.error('Error loading blog posts:', error);
          
          // Fallback: Show a message with manual Substack link
          loadingDiv.style.display = 'none';
          container.style.display = 'none';
          errorDiv.style.display = 'block';
          
          // Add a link to Substack
          const substackLink = `<p style="margin-top: var(--spacing-lg);"><a href="https://${this.substackUsername}.substack.com" target="_blank" style="font-size: 1.1rem; font-weight: 600;">Read on Substack â†’</a></p>`;
          errorDiv.insertAdjacentHTML('afterend', substackLink);
        }
      }

      processSubstackPosts(posts) {
        return posts
          .filter(post => post.type === 'newsletter' && post.publication_id) // Only published posts
          .map(post => ({
            id: post.id,
            title: post.title,
            date: new Date(post.post_date).toLocaleDateString('en-US', { 
              year: 'numeric', 
              month: 'long', 
              day: 'numeric' 
            }),
            category: post.section || 'Article',
            description: post.subtitle || post.body_text?.substring(0, 150) + '...' || 'Read the full post on Substack',
            image: post.cover_image || null,
            url: post.canonical_url || `https://${this.substackUsername}.substack.com/p/${post.slug}`
          }))
          .sort((a, b) => new Date(b.date) - new Date(a.date))
          .slice(0, 12); // Limit to 12 most recent posts
      }

      render() {
        const container = document.getElementById('blog-container');

        if (this.blogPosts.length === 0) {
          container.innerHTML = '<div class="empty-state"><p>No blog posts available yet.</p></div>';
          return;
        }

        container.innerHTML = this.blogPosts.map(post => `
          <article class="blog-card">
            ${post.image ? `<div class="blog-image" style="background-image: url('${this.escapeHtml(post.image)}')"></div>` : '<div class="blog-image" style="background: linear-gradient(135deg, var(--color-accent), var(--color-accent-tertiary));"></div>'}
            <div class="blog-content">
              <span class="blog-category">${this.escapeHtml(post.category)}</span>
              <h2>${this.escapeHtml(post.title)}</h2>
              <p class="blog-date">${post.date}</p>
              <p class="blog-description">${this.escapeHtml(post.description)}</p>
              <a href="${this.escapeHtml(post.url)}" target="_blank" rel="noopener noreferrer" class="read-more">Read on Substack â†’</a>
            </div>
          </article>
        `).join('');
      }

      escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
      }
    }

    // Initialize blog manager with your Substack username
    // Replace 'your-substack-username' with your actual Substack subdomain
    document.addEventListener('DOMContentLoaded', () => {
      const blogManager = new SubstackBlogManager('rahulsatish98');
      blogManager.loadBlogPosts();
    });
  </script>

</body>
</html>